<div id="lessonTopicScreen" class="max-w-md mx-auto rounded-xl overflow-hidden md:max-w-2xl p-6 hidden screen-transition" style="background-color: transparent;">
    <!-- Step indicator -->
    <div class="mb-4 flex items-center gap-2 text-sm text-gray-600" aria-label="Adventure setup steps">
        <div class="flex items-center gap-2 opacity-90">
            <span class="inline-flex items-center justify-center w-6 h-6 rounded-full text-white font-semibold" style="background-color: var(--color-primary-dark);">✓</span>
            <span style="color: var(--color-text-dark);">Choose world</span>
        </div>
        <span class="mx-1">→</span>
        <div class="flex items-center gap-2">
            <span class="inline-flex items-center justify-center w-6 h-6 rounded-full text-white font-semibold" style="background-color: var(--color-primary);">2</span>
            <span class="font-medium" style="color: var(--color-text-dark);">Choose topic</span>
        </div>
    </div>

    <h2 class="text-xl font-semibold text-gray-900">Choose what you’ll learn</h2>
    <p class="text-sm text-gray-600 mt-1">Pick a topic to weave into your story’s challenges.</p>

    <input type="hidden" id="lessonTopic" name="lessonTopic" required>
    <div id="lesson-warning-container" class="warning-container" style="display: none;"></div>
    <div class="carousel-container">
        <div class="carousel" id="lessonCarousel" role="listbox" aria-label="Lesson topics">
            {% for topic in lesson_topics %}
            <div class="carousel-card" role="option" aria-selected="false" tabindex="0" data-topic="{{ topic }}">
                <div class="card-face card-front">
                    <img src="/static/images/lessons/{{ topic }}.jpg" alt="{{ topic }}" class="card-image">
                </div>
                <div class="card-face card-back">
                    <div class="carousel-title">{{ topic }}</div>
                    <div class="carousel-description">
                        {% if topic in topic_subtopics and topic_subtopics[topic] %}
                            Topics include {{ topic_subtopics[topic]|join(', ') }}!
                        {% else %}
                            Learn about {{ topic }}!
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="carousel-nav">
            <button type="button" onclick="window.lessonCarousel.rotate('prev')" aria-label="Previous">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                </svg>
            </button>
            <button type="button" onclick="window.lessonCarousel.rotate('next')" aria-label="Next">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M8.59 7.41L10 6l6 6-6 6-1.41-1.41L13.17 12z"/>
                </svg>
            </button>
        </div>
    </div>
    <div class="mt-4">
        <button id="lesson-start-btn" onclick="startAdventure()" disabled
                class="primary-button w-full flex justify-center py-2 px-4 rounded-md shadow-sm text-sm font-medium text-white cursor-not-allowed disabled:opacity-60 focus:outline-none"
                style="background: var(--color-primary-gradient);"
        >
            Start adventure
        </button>

    </div>
</div>